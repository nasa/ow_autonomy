// The Notices and Disclaimers for Ocean Worlds Autonomy Testbed for Exploration
// Research and Simulation can be found in README.md in the root directory of
// this repository.

  // Monitor for goal errors
  // Clear them
  // Terminate on power fault

  // To test:
  //  - Start this plan
  //  - induce goal errors
  //    - camera: inject fault
  //    - arm: attempt the impossible
  //    - pan/tilt: ?
  //    - task: ?

  // Issues:
  //   - how will auto-clearing interact with this plan?
  //     - is this an issue with the epic branch?

#include "ow-interface.h"

FaultClearDemo:
{
  log_info ("Starting FaultClear demo...");

  Demo: Concurrence
  {
    Exit Lookup(PowerFault);

    ClearArmFault:
    {
      Start Lookup(ArmGoalError);
      Repeat !Lookup(PowerFault);

      log_info ("Clearing Arm goal error.");
      LibraryCall FaultClear (fault=ARM_GOAL_ERROR);
    }

    ClearCameraFault:
    {
      Start Lookup(CameraGoalError);
      Repeat !Lookup(PowerFault);

      log_info ("Clearing Camera goal error.");
      LibraryCall FaultClear (fault=CAMERA_GOAL_ERROR);
    }

    ClearAntennaFault:
    {
      Start Lookup(PanTiltGoalError);
      Repeat !Lookup(PowerFault);

      log_info ("Clearing Pan/Tilt goal error.");
      LibraryCall FaultClear (fault=PAN_TILT_GOAL_ERROR);
    }

    ClearTaskFault:
    {
      Start Lookup(TaskGoalError);
      Repeat !Lookup(PowerFault);

      log_info ("Clearing Task goal error.");
      LibraryCall FaultClear (fault=TASK_GOAL_ERROR);
    }
  }

  log_info ("Finished FaultClear demo.");
}
